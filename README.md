# Wear OS PPG 및 심박수 데이터 블루투스 전송 앱

## 개요

이 애플리케이션은 삼성 갤럭시 워치(Wear OS)에 내장된 센서를 사용하여 Raw PPG(광용적맥파) 데이터와 심박수(HR) 데이터를 실시간으로 측정하고, 연결된 PC(컴퓨터)로 블루투스 클래식(SPP)을 통해 전송하기 위해 개발되었습니다.

원래 Empatica E4 기기를 사용한 감정 인식 연구를 진행하던 중, 기기 사용 중단 문제로 인해 갤럭시 워치를 대체 센서 소스로 활용하고자 직접 개발하게 되었습니다.

## 주요 기능

* **실시간 심박수(HR) 및 심박간격(IBI) 측정:** Samsung Health SDK를 사용하여 연속적인 심박수 데이터를 측정합니다.
* **실시간 Raw PPG 데이터 측정:** Samsung Health SDK를 통해 PPG Gree 데이터를 측정합니다.
* **블루투스 클래식(SPP) 통신:** 측정된 센서 데이터를 지정된 PC의 블루투스 주소로 실시간 전송합니다.
* **JSON 데이터 형식:** 전송되는 데이터는 처리가 용이하도록 JSON 형식으로 구성됩니다.
* **UI 제공:** 현재 블루투스 연결 상태, 수신된 센서 데이터(HR, PPG)를 워치 화면에 표시하고, 센서 측정 시작/중지 기능을 제공합니다.

## 설정 및 준비사항

1.  **워치-PC 페어링:** 앱을 사용하기 전에 데이터를 수신할 PC와 갤럭시 워치를 **반드시 블루투스로 페어링**해야 합니다.
2.  **PC 블루투스 서버:** PC에서는 블루투스 SPP 연결을 수락하고 데이터를 수신할 수 있는 서버 애플리케이션이 실행 중이어야 합니다. (함께 개발된 Python 서버 예제 참고)
3.  **워치 권한:** 앱 설치 후 처음 실행 시 **[신체 센서(Body Sensors)]** 및 **[주변 기기(Nearby devices - Bluetooth Connect)]** 권한을 **반드시 허용**해야 합니다.
4.  **Samsung Health Platform:** 워치에 Samsung Health Platform(또는 관련 서비스)이 설치 및 최신 상태로 업데이트되어 있어야 SDK가 정상적으로 작동합니다.

## 사용 방법

1.  워치에서 앱을 실행합니다.
2.  필요한 권한(신체 센서, 주변 기기)을 요청하면 허용합니다.
3.  PC에서 블루투스 서버 애플리케이션을 실행합니다.
4.  워치 앱 화면에서 **[PC 연결]** 버튼을 눌러 미리 설정된 PC 주소(`TARGET_PC_ADDRESS` 상수 확인)로 블루투스 연결을 시도합니다.
5.  "BT 연결 성공" 메시지가 표시되면 블루투스 연결이 완료된 것입니다.
6.  **[측정 시작]** 버튼을 눌러 심박수 및 PPG 센서 데이터 측정을 시작합니다.
7.  측정된 데이터는 화면에 표시되고, 동시에 연결된 PC로 JSON 형식으로 전송됩니다.
8.  측정을 중지하려면 **[측정 중지]** 버튼을 누릅니다.
9.  PC와의 블루투스 연결을 끊으려면 **[연결 끊기]** 버튼을 누릅니다.

## 전송 데이터 형식 (JSON 예시)

* **심박수 데이터:**
    ```json
    {
      "status": 1, // HR 상태 코드 (Status 객체 참조)
      "hr": 75,    // 심박수 (bpm)
      "ibi": 800,  // 심박 간격 (ms)
      "qIbi": 0    // IBI 품질
    }
    ```
* **PPG 데이터:**
    ```json
    {
      "timestampNs": 1234567890123, // 타임스탬프 (나노초 단위, 기준 시점은 SDK 확인 필요)
      "green": 15000,            // Green PPG 값
      "greenStatus": 0,          // Green 채널 상태 코드 (Nullable)
    }
    ```

## 주요 의존성

* Samsung Health SDK (Privileged SDK가 아닌 일반 SDK 사용 시 기능 제한 가능성 있음)
* Androidx Wear Compose (UI)
* Kotlin Coroutines (비동기 처리)
* Gson (JSON 변환)
* Android Bluetooth API (Classic SPP)

## 알려진 이슈 및 제한 사항

* **배터리 소모:** 실시간 센서 측정 및 블루투스 통신은 워치 배터리를 빠르게 소모시킬 수 있습니다.
* **백그라운드 실행:** 현재 구현은 `MainActivity` 중심으로 되어 있어, 앱이 백그라운드로 가거나 화면이 꺼지면 데이터 전송이 중단될 수 있습니다. 장시간 안정적인 사용을 위해서는 `ForegroundService` 구현이 필요합니다.

